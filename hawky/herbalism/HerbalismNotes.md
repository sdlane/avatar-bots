# Herbal Effects

# Intro

So, I don’t want to do a bunch of research about real world herbal stuff because that sounds irritating. But, we have this nice set of things from Avatar Lore called Chakras. Explained by Guru Patik in that episode in Season 2\. They have areas of the body, emotions, colors, and general areas of effect. These all provide us ways to clue people in to how the herbal system works.

Players with herbal experience can start with a set of clues towards this and we can put larger clue information in Wan Shi Tong’s library.

Ways to apply herbs

- Tea (Herbal Mix, brewed then ingested)  
- Tincture (Herbs dissolved in alcohol to make a concentrated extract, ingested)  
- Salve (Paste, applied topically)  
- Decoction (Concentrated herbal extract, applied topically)  
- Bath (Herbal mix, applied overnight)  
- Incense (Concentrated extract, applied overnight)

# General Mechanical Effect Ideas

**Stat Changes**

* Restore N HP  
* Restore N Stamina  
* Restore N Chi  
* Take N Damage  
* Lose N Stamina  
* Lose N Chi  
* Increase your max HP by N for \[duration\]  
* Increase your max Stamina by N for \[duration\]  
* Increase your max Chi by N for \[duration\]  
* Reduce your max HP by N for \[duration\]  
* Reduce your max Stamina by N for \[duration\]  
* Reduce your max Chi by N for \[duration\]  
* Increase your bending skill by N for \[duration\]  
* Reduce your bending skill by N for \[duration\]  
* Gain N temporary \[HP/Chi/Stamina\] for the next \[duration\]. If you don’t expend all of it by the end of that time, it disappears.  
* Gain N Inspiration.  
* Lose N Inspiration.  
* For \[duration\], change your Fingerprint ID to \[insert number\].

**Combat**

* Do ±N Strength with an attack of your choice in the next day  
* Resist an attack with the \[incant\] incant in the next day  
* The next time you take damage and do not resist it, take an extra N damage  
* Take an extra N points of damage every time you take damage for \[duration\]  
* Resist an attack of strength N or less within \[duration\]  
* You gain a passive resistance to all attacks of strength 2 or below, or, increase your passive resistance by 1 for the next \[duration\].  
* Resist the next attack of strength N or less for the next \[duration\].  
* For \[duration\], treat all incants as ±N strength.  
* For \[duration\] your weapon attacks do ±N damage.  
* For \[duration\] your weapon attacks do ±N strength.

**Cures**

* Halve the duration of a **poison** or **I forget what I called bad poisons**

**Misc**

* Meditate on the memory of this tea for 1 minute and change your emotional state to \[emotion\]  
* Change your emotional state to \[emotion\]  
* You are paralyzed. You can talk but cannot move for the next \[duration\]  
* You cannot move at a heel-toe pace for \[duration\].  
* Go unconscious for \[duration\].  
* You are wounded.  
* Die immediately. Roleplay accordingly.  
* You feel very uncomfortable. You will die in \[duration\] unless you find out how to stop it.  
* If the next herbal effect you experience has a duration of less than a day, \[double/halve\] its duration.  
* If you are hit by an herbal effect for the next \[duration\], don’t experience the new effect until \[this duration ends.\]  
* Halve the remaining duration of a **\[ongoing** effect/poison\] that is active on you.  
* Resist the next **\[ongoing** effect/poison\] that you would take.  
* The first time you become unconscious within \[duration\], become wounded instead.  
* You’re very confused and delirious. You cannot Meditate or spend Inspiration for the next \[duration\]. Roleplay accordingly

# General RP Effect Ideas

* You gain an irrational fear of the next item card you see for the next \[duration\]. Roleplay accordingly.  
* You cannot see the color blue for the next \[duration\]. Roleplay accordingly.  
* You cannot hear your own name spoken for the next \[duration\]. Roleplay accordingly.  
* You are convinced the lighting is far too dim for the next \[duration\], regardless of reality. Roleplay accordingly. (Gaslight, Gatekeep, Girlboss)  
* You perceive all shadows as subtly moving for the next \[duration\]. Roleplay accordingly.  
* You feel compelled to whisper any important information for the next \[duration\]. Roleplay accordingly.  
* You feel compelled to say things just slightly too loudly for the next \[duration\]. Roleplay accordingly, but don’t yell.  
* You feel compelled to over-explain simple actions for the next \[duration\]. Roleplay accordingly.  
* You feel compelled to narrate your own actions under your breath for the next \[duration\]. Roleplay accordingly.  
* You feel as though you are slightly taller than usual for the next \[duration\]. Roleplay accordingly.  
* You feel convinced you are the tallest person around you for the next \[duration\]. Roleplay accordingly.  
* You believe inanimate objects are judging you for the next \[duration\]. Roleplay accordingly.  
* You believe you briefly understand a deep cosmic truth, but forget it immediately. Roleplay accordingly.  
* You can’t talk for the next \[duration\]. Roleplay accordingly.  
* You have a sudden high fever and blabber incoherently. Roleplay accordingly.  
* You are filled by an intense paranoia of everyone around you. They’re all out to get you. Roleplay accordingly.  
* You are suddenly very dizzy and nauseous. Roleplay accordingly.  
* You hallucinate wildly for the next \[duration\]. Roleplay accordingly.  
* For the next hour, everything you drink tastes like really good oolong tea. Roleplay accordingly.  
* For \[duration\], you become convinced that you cannot see your right hand. Roleplay accordingly.  
* For \[duration\], you believe that you cannot be harmed by any weapon. Roleplay accordingly.  
* You had a fantastic and thrilling dream last night, but you forgot all of it. Roleplay accordingly.  
* You regularly yawn noticeably and uncontrollably for the next \[duration\]. Roleplay accordingly.  
* You got a bad case of hiccups. Roleplay accordingly.  
* Your hiccups just disappeared. Roleplay accordingly.  
* You’re filled with a beautiful and awe-inspiring sense that you’re one with the universe. Roleplay accordingly.  
*   
* You feel you had an amazing sleep last night. Roleplay accordingly.  
* You feel compelled to do an impromptu song or dance performance within the next \[duration\]. Roleplay accordingly.   
* You feel a quiet certainty that everything will work out as it should. Roleplay accordingly  
* You are filled with a deep, peaceful sense of belonging. Roleplay accordingly.  
* You feel a gentle contentment that makes small pleasures feel richer. Roleplay accordingly.  
* You feel a spontaneous urge to hum, whistle, or tap along to an unheard rhythm. Roleplay accordingly.  
* You feel an urge to share a story, joke, or memory that brings joy. Roleplay accordingly.  
* You feel compelled to offer sincere compliments when they come to mind. Roleplay accordingly (Air, Sound)  
* 

# Earth

Deals with Survival  
Blocked by Fear  
Is at the base of the spine  
Color Red

## Effect Ideas

* You feel a deep, instinctive confidence that you can endure whatever comes next. Roleplay accordingly.  
* You feel grounded in the present moment, focused on simple, vital necessities. Roleplay accordingly.

# Water

Deals with Pleasure  
Blocked by Guilt  
Is at the sacrum  
Color Orange

## Effect Ideas

* You are filled with a warmth that reminds you of your childhood home. Roleplay accordingly.  
* You find simple sensations unusually delightful—the taste of food, the warmth of air, the sound of laughter. Roleplay accordingly.  
* You experience a quiet joy in being alive and able to feel. Roleplay accordingly.  
* You are filled with a soft, contented happiness that invites relaxation. Roleplay accordingly.

# Fire

Deals with Willpower  
Blocked by Shame  
Is at the stomach  
Color Yellow

## Effect Ideas

* Doubt fades as you feel certain you can see this through. Roleplay accordingly.

# Air

Deals with love  
Blocked by grief  
At the heart  
Color green

## Effect Ideas

* You feel open-hearted and unafraid to show kindness. Roleplay accordingly  
* You feel a warm sense of camaraderie with those nearby. Roleplay accordingly.  
* 

# Sound

Deals with truth  
Blocked by lies  
Is at the throat  
Color Blue

## Effect Ideas

* Falsehoods feel uncomfortable, while sincerity feels deeply right. Roleplay accordingly.  
* You experience a peaceful alignment between what you think, feel, and say. Roleplay accordingly.

# Light

Deals with Insight  
Blocked by Illusion  
Is at the forehead  
Color indigo

* You experience moments of quiet realization, like pieces gently falling into place. Roleplay accordingly.  
* You feel attentive and perceptive, reading situations with ease. Roleplay accordingly.

## Effect Ideas

# Thought

Deals with pure cosmic energy  
Blocked by earthly attachments  
Is at the crown of the head  
Color violet

## Effect Ideas

* Your sense of self briefly expands, touching something infinite and radiant. Roleplay accordingly.  
* You feel luminous, as though you are a small but perfect part of a boundless whole. Roleplay accordingly.

# Item Numbers

* A first digit of 5 is an herbal ingredient  
* A first digit of 6 is an herbal product  
* The second digit is associated with the primary chakra, the third is associated with the secondary chakra and is 0 if there is none. A second digit of 0, 8, and 9 are reserved for weird things like Ruoshon’s spirit chomping. A third digit of 8 will remove ongoing effects associated with the first chakra. A third digit of 9 will remove poisons associated with the first chakra. A third digit of 0 indicates the thing came from the spirit world  
  * 1: Earth  
  * 2: Water  
  * 3: Fire  
  * 4: Air  
  * 5: Sound  
  * 6: Light  
  * 7: Thought  
* For ingredients, the fourth digit has to do with the strength of the thing and whether it’s positive or negative  
  * 0: Neutral  
  * 1: Positive, Tier 1  
  * 2: Negative: Tier 1  
  * 3: Positive: Tier 2  
  * 4: Negative: Tier 2  
  * 5: Positive: Tier 3  
  * 6: Negative: Tier 3  
  * 7: Mixed both positive  
  * 8: Mixed both negative  
  * 9: Mixed, both positive and negative  
* For products, the fourth digit has to do with the tier and whether its a boon or a bane  
  * 0: Neutral  
  * 1: Boon, Tier 1  
  * 2: Bane: Tier 1  
  * 3: Boon: Tier 2  
  * 4: Bane: Tier 2  
  * 5: Boon: Tier 3  
  * 6: Bane: Tier 3  
  * 7: Boon: Tier 4  
  * 8: Bane: Tier 4  
  * 9: Special

# Abilities

Three levels of ability card. Each has info about reading the cards/how the mixing rules work plus a thing to help. Each also has a mechanical effect that helps with herbalism. All are teachable.

## Basic Herbal Knowledge

Teachable: N Inspiration

3 times per day, you may produce 1 extra herbal product when you make a mix.

The following are true statements about herbal ingredients, herbal products, and how mixing works:

* Making a tincture, decoction, or incense requires alcohol

## Advanced Herbal Knowledge

Teachable: N Inspiration, Requires knowing \\aBasicHerbalism{} and cannot be learned on the same day as \\aBasicHerbalism{}.

3 times per day, you may preserve one ingredient when making a mix.

The following are true statements about herbal ingredients, herbal products, and how mixing works:

* 

## Expert Herbal Knowledge

Teachable: N Inspiration

Teachable: N Inspiration, Requires knowing \\aBasicHerbalism{} and \\aAdvancedHerbalism{} and cannot be learned on the same day as either ability.

3 times per day, you may preserve all but one ingredient when making a mix. You cannot use this at the same time as \\aAdvancedHerbalism{}.

The following are true statements about herbal ingredients, herbal products, and how mixing works:

* 

# Blending Rules

Ingredients have a set of Chakras and values for those chakras that are between \-3 and 3, inclusive. Ingredients can have up to two Chakras, one will always have a lower value than the other. Some ingredients have the hidden properties “aromatic”, “ingestible”, and/or “spirit”. Some ingredients have the non-hidden properties “alcohol” or “salt”. Those will be in a “properties” list in the database, separated by commas.

## Meta Rules

* A particular set of items will always produce the same result  
* Some specific recipes will require specific blends

## Recipe Notes

* BRANCH: There is an ingredient with the hidden “spirit” property  
* BRANCH: There is not an ingredient with the hidden "spirit" property  
  * Call FetchConstraintRecipes  
    * If this returns an empty list, FetchRuinedProduct of the appropriate type and return the result  
  * Check for \[special healing ingredient\]  
    * If \[special healing ingredient\] is present, and the primary chakra is positive, it produces a mix of the appropriate type that will let you remove any one ongoing, poison, or lasting poison effect. If the primary chakra is not positive it is a failed mix.  
  * Check ingredients in ascending order for an ingredient with 8 in the third digit  
    * If there is an ingredient with an 8 in the third digit, the primary chakra has a negative magnitude, and the primary chakra matches the chakra of the ingredient, it will produce a bane of the correct type that will remove an ongoing effect of that chakra of the resulting tier or less. If the primary chakra is mismatched, or if its magnitude is positive, continue down this rules list.  
  * Check ingredients in   
  * If it has a 9 in the third digit, the primary chakra has a positive magnitude, and the primary chakra matches the chakra of the ingredient, it will produce a thing of the correct flavor that will cure a poison of that chakra of the resulting tier or less. If it is Tier 3, it will cure lasting poisons of that chakra. If the primary chakra is mismatched, or if its magnitude is negative, continue down this rules list.  
  * Check for two chakra recipes  
  * Check for one chakra recipes  
  * Produce a failed mix of the appropriate type

# Pseudocode

### Hawky Command

/blend-herbs  
Inputs: Ingredient 1, Ingredient 2, Ingredient 3, Ingredient, 4, Ingredient 5, Ingredient 6  
Outputs: A temporary embed that includes the information about the product or a temporary messages obtaining an error message.

The embed should include:  
Type, Name, Item Number, Quantity Produced, Flavor Text, Rules Text, and a note that you can find it in the box room in the envelope labeled Type: Item Number and to tell the GMs if the folder is running low.

It calls MakeBlend using the input ingredients to get the product and the quantity.

### MakeBlend

Input: List of strings as input by the user into the hawky bot command. Contains at least one string and up to 6\.  
Output: A string representing an error message, or a product object and an integer representing the quantity

* Sort ingredients by item number in descending order  
* Fetch ingredients from database  
  * Ingredients have unique item numbers  
  * If an ingredient is not found, register an error that the item number cannot be used for herbalism but continue fetching items  
* If there are any errors that item numbers are not found, hawky prints an error message that indicates all items that cannot be used for herbalism and exits  
* Check the kind of product with CalcProductType  
  * If the method returned a product, that product should be returned with 1 as the quantity  
  * If the method returned a string, use that string in the next stage.  
* Get the product with CalcProduct which should always return a product and a quantity, if there is no quantity returned, assume it’s 1  
* Return that product to hawky

### CalcProductType

Input: List of ingredient objects  
Output: Either a product or a string form the following set:  
“tea”, “salve”, “bath”, “tincture”, “decoction”, “incense”

* Count the alcohol with CountProperty  
* If it has more than two alcohol  
  * Fetch the ruined tincture info from the DB and return the product  
  * If that isn’t found, return sludge.  
* Check if the product is ingestible with AllHaveProperty  
* If it has two alcohol:   
  * If it is ingestible return “tincture”  
  * Otherwise, fetch ruined tincture using FetchRuinedProduct and return that  
* Else If it has one alcohol:  
  * If it is ingestible, return “tincture”  
  * If it has at least one ingredient with the hidden property of “aromatic”, return "incense"  
  * Return “decoction”  
* Else:  
  * If it is ingestible, return “tea”  
  * If there is at least one ingredient with the hidden property of “salt”, return “bath”  
  * Return “salve”  
* If we’ve hit here, log an error to the error stream and return sludge.

### CalcProduct

One method with these rules that calls helper methods. It takes the product type and the list of ingredient objects as input and returns a product object. 

Returns a product and a quantity

* Check for subset recipe matches using FetchSubsetRecipes  
  * If that returns a non-empty list  
    * Fetch the product with the item number of the recipe with the largest subset that matches the input product type  
    * Return the product for the recipe with the largest subset and the quantity specified by the recipe, or 1 if the quantity is not present.  
* Get the primary and secondary chakras along with the tier of the effect using one helper method  
  * Method takes the list of ingredient objects as input  
  * Total the positive and negative values for each chakra present in the ingredients.  
  * The highest magnitude chakra is the primary chakra  
  * The second highest magnitude chakra is the secondary chakra.  
    * There may not be a secondary chakra  
  * The magnitude of the secondary chakra is subtracted from the magnitude of the primary chakra to determine the tier of the effect.  
    * \>10 is Tier 3  
    * Between 4 and 7 inclusive is Tier 1  
    * Between 8 and 10 inclusive is Tier 2  
    * \< 4 is returns 0  
  * If there is no secondary Chakra, add 1 to the Tier  
* If that method returns 0 for the tier, call FetchRuinedProduct and return the result with 1 for the quantity  
* Call FetchConstraintRecipes  
  * If this returns an empty list, FetchRuinedProduct of the appropriate type and return the resulting product with 1 as the quantity  
  * If there are items in the list, fetch the item from the database that matches the product item number specified by the recipe that was inserted into the database the earliest.  
  * Return that item and the quantity from the recipe.  
* If we’ve hit here, log an error to the error stream and return sludge

## Helper Methods

* ValidateProductType  
  * Takes a string with information about where the validation was called  
  * Logs an error to the error stream that indicates a non-valid product was received if the product is not valid  
  * Returns true if the product type is valid and false otherwise  
* AllHaveProperty  
  * Takes a list of ingredient objects and a string for a property type as input  
  * Checks each of the ingredients, returns true if all have the input hidden property  
* NoneHaveProperty  
  * Takes a list of ingredient objects and a string for a property type as input  
  * Checks each of the ingredients, returns true if none have the input hidden property, returns false otherwise  
* HasProperty  
  * Takes a list of ingredient objects and a string for a property type as input  
  * Checks each of the ingredients, returns true if at least one has the input hidden property  
* CountProperty  
  * Takes a list of ingredient objects and a string for a property type as input  
  * Counts the number of ingredients that have the input string  
* FetchRuinedProduct  
  * Takes a string for the product type.  
  * Validates the product type  
    * If not valid, returns the sludge object. No need to log an additional error here as the product type helper does that  
  * Fetches the ruined product number from the database  
    * If failure, log an error to the error stream and return the sludge product  
  * Fetches the product info using that number  
    * If failure, log an error to the error stream and return the sludge product  
  * Returns the fetched product  
* FetchSubsetRecipes  
  * Takes a product type and a list of ingredient objects as input  
  * Queries the recipes table and fetches all recipes that are a subset of the input ingredients  
  * Returns the subset recipes that match the inputs sorted by the length of the subset descending or None  
* FetchConstraintRecipes  
  * Takes a product type, tier, primary chakra, whether the primary chakra is a boon or bane, secondary chakra, whether the secondary chakra is a boon or a bane, and list of ingredients  
  * Queries the ConstraintRecipes table and returns the list of recipes the input matches sorted in FIFO order based on when the recipe was added to the database or an empty list if there are no recipes that meet this constraint.

## Scripts

### Helpers for these scripts

#### LoadIngredients

Input: Filename  
Output: List of ingredient objects

Ingredients are stored in a CSV file with the following columns:   
Name, Macro, Rarity, Item Number, Primary Chakra, Primary Chakra Strength, Secondary Chakra, Secondary Chakra Strength, Properties, Flavor Text, Rules Text, Skip Export

Name is a string  
Macro is a string  
Rarity is a string  
Item number is a string that represents a 4 digit number  
Primary Chakra is a string  
Primary chakra strength is an integer between \-3 and 3 inclusive  
Secondary chakra is a string  
Secondary chakra strength is an integer between \-3 and 3 inclusive  
Properties is a string that contains comma separated list of strings  
Flavor text is a string  
Rules Text is a string  
Skip export should be true if that column contains a value and false otherwise

#### LoadProducts

Input: Filename  
Output: List of Product objects

Products are stored in a CSV file with the following columns:  
Name, Macro, Type, Item Number, Flavor Text, Rules Text

All columns are nullable except item number.

Name is a string  
Macro is a string  
Type is a string  
Item number is a string that represents a 4 digit number  
Flavor text is a string  
Rules Text is a string  
Skip export should be true if that column contains a value and false otherwise

#### LoadSubsetRecipes

Input: Filename  
Output: List of SubsetRecipe objects

Subset recipes are stored in a CSV file with the following columns:  
Product Item Number, Product Type, Quantity Produced, Ingredient 1, Ingredient 2, Ingredient 3, Ingredient 4, Ingredient 5, Ingredient 6\.

All columns are strings except quantity produced which is an integer with a positive value.

Product Item Number and Product Type are not nullable. All other columns are nullable  
Product Item Number corresponds to a product in the products table 

The ingredient columns should be sorted in descending order after import and should possibly be stored as a list? There needs to be at least one ingredient.

#### LoadConstraintRecipes

Input: Filename  
Output: List of ConstraintRecipe objects

Constraint recipes are stored as a row in a CSV file. The first three columns are Product Item Number, Product Type, and Quantity Produced.

All columns are strings except quantity produced which is an integer with a positive value.

Product Item Number and Product Type are not nullable. All other columns are nullable.

Product Type is also a constraint that is met if the blend would produce a product of that type.

* Ingredients, list of one or more strings that represents an item number  
  * The item numbers are 4 digit numbers and can include wildcards, i.e. \*  
  * Constraint is met if the proposed blend includes ingredients that match all of the ingredients in this list  
* Primary Chakra, string  
  * Constraint is met if the primary chakra of the blend matches that string  
* Primary Chakra is boon/bane, string containing either “boon” or “bane”  
  * If the value is boon, constraint is met if the primary chakra of the blend has a positive value  
  * If the value is bane, constraint is met if the primary chakra of the blend has a negative value  
* Secondary Chakra, string  
  * Constraint is met if the secondary chakra of the blend matches string   
* Secondary Chakra is bone/bane, string containing either “boon” or “bane”  
  * If the value is boon, constraint is met if the secondary chakra of the blend has a positive value  
  * If the value is bane, constraint is met if the secondary chakra of the blend has a negative value  
* Tier, integer  
  * Constraint is met if the blend would produce a product with that tier exactly

#### LoadFailedBlends

Input: Filename  
Output: List of FailedBlend objects

FailedBlends are stored in a CSV file with the following columns: Product Item Number, Type

Both are strings, neither is nullable.

#### ClearHerbalData

Input: None  
Output: None  
Calls the clear methods below

#### ClearIngredients

Input: None  
Output: None  
Clears data from the Ingredient table

#### ClearProducts

Input: None  
Output: None  
Clears the data from the Product table

#### ClearSubsetRecipes

Input: None  
Output: None

#### ClearConstraintRecipes

Input: None  
Output: None  
Clears the data from the ConstraintRecipe table

### ClearFailedBlends

Input: None  
Output: None  
Clears the data from the FailedBlend table

### ConvertToLatex

This is a script that has variables at the top that store:

* Ingredients filename, string  
* Products filename, string

It calls LoadIngredients using that filename, then calls ConvertIngredients using the result, and then saves the resulting string to a file called ingredients.tex.

Then it calls LoadProducts using that filename, then calls ConvertProducts on the result, and then saves the resulting string to a file called products.tex.

#### ConvertIngredients

Input: List of ingredient objects  
Output: String containing gametex items for each object.

It should sort the ingredients alphabetically by macro, storing that in a new list, not modifying the original.

It calls ConvertIngredient for each ingredient in the list and then merges the output into one long string.

#### ConvertIngredient

Input: Ingredient object  
Output: String containing gametex item for that ingredient or an empty string if the skip export field is true.

Square brackets contain the names of fields on the object and should be replaced with the appropriate values.

\\NEW{Item}{\\i\[macro\]}{  
  \\s\\MYname     {\[name\]}  
  \\s\\MYnumber   {\[item number\]}  
  \\s\\MYtext     {\\textit{\[flavor text\]}

\[rules text\]  
}  
}

#### ConvertProducts

Input: List of product objects  
Output: String containing gametex items for each object.

It sorts the products by type and then alphabetically by macro within each type. It should then call ConvertProduct on each resulting object. It should insert a LaTeX comment between each new type of product that is the type name.

#### ConvertProduct

Input: Product object  
Output: String containing gametex item for that product.

\\NEW{ItemFold}{\\i\[macro\]}{  
  \\s\\MYname    {\[type\]: \[name\]}  
  \\s\\MYnumber    {\[item number\]}  
  \\s\\MYtext    {\\textit{flavor text}}  
  \\s\\MYcontents    {\[rules text\]}  
}

### ImportHerbalism

This script has variables at the top that store:

* Ingredients filename, string  
* Products filename, string  
* Subset Recipes filename, string  
* Constraint Recipes filenames, list of strings  
* Failed Mixes filename, string

It should call the clear helper methods above to empty the herbal data, then load the data from the input files. Then it should insert each thing into the database in the order it appears in the resulting lists.

The constraint recipes should be imported in the order they are specified in the list of strings. The resulting lists should be appended but should not be sorted at all.
